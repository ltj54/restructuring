import{r as t,a as H,j as e}from"./index-DPH6xsyd.js";import{C as S}from"./Card-BmXYs-DD.js";import{P as _}from"./PageLayout-DnFQoWr9.js";import{m as c}from"./proxy-sF5lwSFm.js";const R=60,K={initial:{scale:1,opacity:1},animate:{scale:[1,1.12,1],opacity:[1,.7,1],transition:{duration:1.6,repeat:1/0}}};function z({waitingForResponse:s,waitingSecondsLeft:l}){return s?e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40",children:e.jsxs(c.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-xl max-w-sm w-full px-6 py-5 text-sm text-slate-800",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:"Venter på svar fra tjenesten..."}),e.jsx("p",{className:"mt-2 text-slate-700",children:"Backend kjører på Render (gratisversjon), og kan bruke litt tid på å starte opp når den har vært inaktiv."}),e.jsxs("p",{className:"mt-3 text-xs text-slate-500",children:["Estimert ventetid:"," ",l!==null?`${l} sekunder`:`${R} sekunder`]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Popupen forsvinner automatisk så snart vi får svar fra tjenesten."})]})}):null}function V({status:s}){const l=s==="ok"?"bg-green-100 text-green-800 border-green-300":s==="feil"?"bg-red-100 text-red-800 border-red-300":"bg-slate-100 text-slate-700 border-slate-300";return e.jsxs(c.div,{variants:K,initial:"initial",animate:"animate",className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm mt-4 ${l}`,"aria-live":"polite",children:[e.jsx("span",{"aria-hidden":"true",className:`h-2.5 w-2.5 rounded-full ${s==="ok"?"bg-green-500":s==="feil"?"bg-red-500":"bg-slate-500"}`}),e.jsx("span",{className:"font-semibold",children:s==="ok"?"Online":s==="feil"?"Offline":"Ukjent"})]})}function q({history:s}){if(s.length===0)return e.jsx("p",{className:"text-sm text-slate-700",children:"Ingen historikk ennå."});const l=s.length>0?Math.max(...s.map(a=>a.durationMs||0),1):1;return e.jsx("div",{className:"space-y-2 text-xs text-slate-700",children:s.map((a,o)=>{const p=a.durationMs?Math.min(100,a.durationMs/l*100):5,r=a.status==="ok"?"bg-green-500":a.status==="feil"?"bg-red-500":"bg-slate-400";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20",children:a.time.toLocaleTimeString()}),e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${r}`,style:{width:`${p}%`}})}),e.jsx("div",{className:"w-16 text-right",children:a.durationMs?`${Math.round(a.durationMs)} ms`:"-"})]},o)})})}function Z(){const[s,l]=t.useState("ukjent"),[a,o]=t.useState(null),[p,r]=t.useState(""),[,w]=t.useState(!1),[C,$]=t.useState(null),[d,h]=t.useState("ukjent"),[E,M]=t.useState(null),[T,m]=t.useState(""),[F,L]=t.useState([]),[D,I]=t.useState(!1),[j,k]=t.useState(!1),[g,b]=t.useState(null),x=t.useCallback(()=>{k(!0),b(R)},[]),u=t.useCallback(()=>{k(!1),b(null)},[]),N=t.useMemo(()=>`${H}/hello`,[]),y=t.useMemo(()=>`${H}/dbinfo`,[]),v=t.useCallback(async()=>{w(!0),r(""),x();const i=performance.now();let n="ukjent",B=null;try{const f=await fetch(N);B=f.status,o(f.status),f.ok?(n="ok",l("ok"),r("Backend svarer som forventet.")):(n="feil",l("feil"),r("Backend svarte, men med feil.")),u()}catch{n="feil",l("feil"),r("Ingen respons fra backend."),o(null)}finally{const O=performance.now()-i;$(new Date),w(!1),L(U=>[{time:new Date,status:n,httpCode:B,durationMs:O},...U].slice(0,10))}},[N,x,u]);t.useEffect(()=>{v()},[v]),t.useEffect(()=>{if(!j)return;if(g===0){k(!1);return}const i=window.setInterval(()=>{b(n=>n!==null&&n>0?n-1:n)},1e3);return()=>window.clearInterval(i)},[j,g]);const P=t.useCallback(async()=>{m(""),x();try{const i=await fetch(y);if(M(i.status),i.ok){const n=await i.text();h("ok"),m(n)}else h("feil"),m("DB-endepunkt svarte, men med feil.");u()}catch{h("feil"),M(null),m("Ingen respons fra DB-endepunkt.")}},[y,x,u]),W=async()=>{I(!0);try{await v(),await P()}finally{I(!1)}},A=d==="ok"?"text-green-700":d==="feil"?"text-red-700":"text-slate-700";return e.jsxs(_,{title:"Systemstatus",subtitle:"Health-check og responstider for backend.",maxWidthClassName:"max-w-6xl",children:[e.jsx(z,{waitingForResponse:j,waitingSecondsLeft:g}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-6",children:[e.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-2",children:e.jsxs(S,{title:"Backend-status",children:[e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Hello-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:N})]}),e.jsx(V,{status:s}),e.jsx("div",{className:"flex flex-wrap items-center gap-3 mt-4",children:e.jsx("button",{onClick:W,disabled:D,className:"border border-slate-300 text-slate-800 px-4 py-2 rounded-xl text-sm font-semibold hover:bg-slate-50 transition inline-flex items-center justify-center disabled:opacity-60 disabled:cursor-not-allowed",children:D?"Kjører full helsesjekk...":"Full helsesjekk"})}),e.jsxs("p",{className:"mt-3 text-sm text-slate-600",children:["Sist sjekket: ",C?C.toLocaleTimeString():"Aldri"]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["HTTP-kode (hello): ",a??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Melding:"})," ",p]})]})}),e.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(S,{title:"Detaljert helsesjekk",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:y})]}),e.jsxs("p",{className:`mt-2 ${A}`,children:["Status: ",d==="ok"?"OK":d==="feil"?"Feil":"Ukjent"]}),e.jsxs("p",{className:"text-sm text-slate-700",children:["HTTP-kode (dbinfo): ",E??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-xs text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-melding:"})," ",T||"Ingen sjekk ennå."]})]})})}),e.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-3",children:e.jsx(S,{title:"Responstid & logg",children:e.jsx(q,{history:F})})})]})]})}export{Z as default};
