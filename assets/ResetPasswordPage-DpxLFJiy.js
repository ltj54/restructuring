import{r as l,b as c,g as u,d as f,j as e,L as g}from"./index-IST0QHVW.js";import{u as k,t as x,F as h,T as p}from"./types-CUtUjmsB.js";import{C as b}from"./Card-BoiwNR6c.js";import{B as w}from"./Button-BIXv3_rL.js";import{a as y}from"./authSchemas-Cwv3-339.js";import{P as S}from"./PageLayout-BE_FrvBE.js";function j(t){const[d,r]=l.useState(()=>t?null:{variant:"error",message:"Ugyldig eller manglende tilbakestillingslenke."}),[a,n]=l.useState(!1),s=k({resolver:x(y),defaultValues:{token:t,password:"",confirm:""},mode:"onTouched"});l.useEffect(()=>{s.setValue("token",t,{shouldValidate:!0,shouldDirty:!1})},[s,t]);const i=l.useMemo(()=>s.handleSubmit(async o=>{r(null),n(!0);try{(await fetch(`${c}/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:o.token,password:o.password})})).ok?(r({variant:"success",message:"Passordet er oppdatert! Du kan nå logge inn."}),s.reset({token:o.token,password:"",confirm:""})):r({variant:"error",message:"Kunne ikke oppdatere passordet. Lenken kan være utløpt."})}catch(m){r({variant:"error",message:u(m,"Ingen kontakt med serveren.")})}finally{n(!1)}}),[s]);return{form:s,feedback:d,isSubmitting:a,onSubmit:i}}function B(){const[t]=f(),d=t.get("token")||"",{form:r,feedback:a,isSubmitting:n,onSubmit:s}=j(d),{register:i,formState:{errors:o}}=r;return e.jsx(S,{title:"Tilbakestill passord",subtitle:"Sett et nytt passord for å komme videre.",maxWidthClassName:"max-w-xl",children:e.jsxs(b,{children:[a&&e.jsx(h,{variant:a.variant,message:a.message,action:a.action}),e.jsxs("form",{onSubmit:s,className:"flex flex-col gap-5",children:[e.jsx("input",{type:"hidden",...i("token")}),e.jsx(p,{type:"password",label:"Nytt passord",placeholder:"Nytt passord",autoComplete:"new-password",error:o.password?.message,...i("password")}),e.jsx(p,{type:"password",label:"Bekreft nytt passord",placeholder:"Bekreft nytt passord",autoComplete:"new-password",error:o.confirm?.message,...i("confirm")}),e.jsx(w,{type:"submit",disabled:n,children:n?"Oppdaterer.":"Oppdater passord"})]}),e.jsx("p",{className:"mt-6 text-center text-sm text-slate-600",children:e.jsx(g,{to:"/login",className:"text-brand-dark font-medium hover:underline",children:"Tilbake til innlogging"})})]})})}export{B as default};
