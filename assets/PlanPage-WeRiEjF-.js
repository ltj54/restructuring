import{a as J,u as $,r as a,f as P,j as t,L as _}from"./index-DY5-8eit.js";import{C as Q}from"./Card-CSTHicjx.js";import{B as N}from"./Button-CslG25di.js";import{P as W}from"./PageLayout-BiITw9I-.js";const w={"Før omstilling":{title:"Før omstilling - bygg trygghet tidlig",description:"Du er i en tidlig fase. Målet nå er å skaffe oversikt og forberede deg uten unødig stress.",bullets:["Skriv ned hva som bekymrer deg konkret - ikke bare «omstilling generelt».","Finn ut hvem som faktisk vet hva (leder, HR, tillitsvalgt).","Sjekk hvilke forsikringer og ordninger du allerede har."],diaryTitle:"Dagbok - før omstilling",diaryDescription:"Skriv ned bekymringer, spørsmål og hva du bør sjekke tidlig.",diaryPlaceholder:"Hva lurer du på nå? Hva trenger du svar på? Hva bekymrer deg?",actions:["Lag liste over hva du vet - og hva du ikke vet.","Ta kontakt med leder eller HR for avklaringer.","Kartlegg dine forsikringer og økonomi.","Begynn stille med oppdatering av CV."]},"Under omstilling":{title:"Under omstilling - ta kontroll på endringene",description:"Endringene er i gang. Her handler planen om å beholde oversikt og bruke rettighetene dine aktivt.",bullets:["Sørg for skriftlig informasjon om forslagene som gjelder deg.","Be om et konkret møte om din rolle og dine alternativer.","Lag et regneark med «nå» og «etter omstilling» for lønn og arbeidstid."],diaryTitle:"Dagbok - under omstilling",diaryDescription:"Skriv ned punkter fra møter, frister og ting du må følge opp.",diaryPlaceholder:"Hva ble sagt i møtet? Hva må du følge opp? Hvilke frister kom opp?",actions:["Be om alt skriftlig.","Lag oversikt over konsekvenser (lønn, arbeidstid, arbeidsoppgaver).","Book rådgiving (tillitsvalgt/HR).","Loggfør alle møter i dagboken."]},"Etter omstilling":{title:"Etter omstilling - juster økonomi og kurs",description:"Omstillingen er gjennomført. Nå handler det om økonomi, karriere og neste steg.",bullets:["Oppdater budsjett basert på ny inntekt og arbeidstid.","Lag en 3-måneders plan for kompetanse, CV og søknader.","Vurder behov for ekstra inntektssikring."],diaryTitle:"Dagbok - etter omstilling",diaryDescription:"Bruk notater til å planlegge neste steg: karriere, økonomi og mål.",diaryPlaceholder:"Hva er neste steg? Hvilke jobber vurderer du? Hva er målene dine?",actions:["Oppdater budsjett.","Planlegg kurs eller kompetanseheving.","Søk på jobber eller interne muligheter.","Lag en 3-måneders utviklingsplan."]}},b=["Før omstilling","Under omstilling","Etter omstilling"],q=["Få oversikt over rettigheter og avtaler","Forstå hva omstillingen betyr for lønn og økonomi","Planlegge neste karrieresteg","Snakke med noen om situasjonen","Få kontroll på forsikringer og inntektssikring"],c=g=>g?g==="For omstilling"?"Før omstilling":g:b[0];function ee(){const g=J(),{isAuthenticated:h}=$(),m=new URLSearchParams(g.search).get("phase")??"",[p,f]=a.useState(null),[D,L]=a.useState({}),[n,o]=a.useState(""),[I,k]=a.useState(!1),[z,E]=a.useState(!1),[H,A]=a.useState(null),[u,v]=a.useState(b[0]),[d,y]=a.useState([]),[O,x]=a.useState(null),[F,j]=a.useState(!1),B=n||u||b[0],i=w[B]??w[b[0]];a.useEffect(()=>{const e=localStorage.getItem("myPlan");if(e)try{const s=JSON.parse(e),r=c(s.phase);v(r),s.needs&&y(s.needs),(s.persona||s.phase||s.needs)&&f(l=>l??{persona:s.persona??"Annet",fase:r,behov:s.needs??[],createdAt:new Date().toISOString()}),o(l=>l||r)}catch{}},[]),a.useEffect(()=>{n||o(u)},[n,u]),a.useEffect(()=>{if(m){const e=c(m);v(e),o(e)}},[m]),a.useEffect(()=>{h&&(k(!0),(async()=>{try{const e=await P("/plan/me");if(!e){k(!1);return}const s=c(e.phase),r=e.phase?{persona:e.persona??"Annet",fase:s,behov:e.needs??[],createdAt:e.createdAt??new Date().toISOString()}:null;f(r),v(s),y(e.needs??[]);const l={...e.diaries};e.phase&&e.diary&&!l[e.phase]&&(l[e.phase]=e.diary);const C={};if(Object.entries(l).forEach(([S,V])=>{C[c(S)]=V}),L(C),!n){const S=c(m||e.phase);o(S)}}catch{}finally{k(!1)}})())},[h,n,m]);const T=e=>{y(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},R=async()=>{x(null);const e=c(u),s=p?.persona??"Annet",r={persona:s,fase:e,behov:d,createdAt:p?.createdAt??new Date().toISOString()};if(j(!0),f(r),o(l=>l||e),localStorage.setItem("myPlan",JSON.stringify({persona:s,phase:e,needs:d})),localStorage.setItem("personaLabel",s),h)try{await P("/plan/me",{method:"PUT",body:{persona:s,phase:e,needs:d}}),x("Planen er lagret.")}catch{x("Kunne ikke lagre hos serveren, men planen er lagret lokalt.")}finally{j(!1)}else j(!1),x("Planen er lagret lokalt.")},U=e=>{const s=e.target.value;A(null),n&&(L(r=>({...r,[n]:s})),h&&(E(!0),(async()=>{try{const r=d.length?d:p?.behov??[];await P("/plan/me",{method:"PUT",body:{persona:p?.persona??"Annet",phase:n,needs:r,diary:s}})}catch{A("Kunne ikke lagre endringen nå.")}finally{E(!1)}})()))},M=t.jsxs(t.Fragment,{children:[t.jsx(N,{to:"/wizard",className:"bg-gradient-to-r from-emerald-400 to-teal-500 text-slate-900 border-transparent font-semibold",children:"Start veiviseren"}),t.jsx(N,{to:"/resources",className:"bg-white text-emerald-700 border-emerald-200 hover:bg-emerald-50 font-semibold",children:"Se ressurser"})]});return t.jsx(W,{title:"Min plan",subtitle:"Fire steg som gir deg oversikt: fase, økonomi, kompetanse og konkrete handlinger.",actions:M,maxWidthClassName:"max-w-5xl",children:t.jsxs(Q,{children:[I&&t.jsx("p",{className:"mb-3 text-xs text-slate-500",children:"Laster plan ..."}),t.jsxs("section",{className:"mb-6 rounded-2xl border border-slate-200 bg-white p-4 text-sm",children:[t.jsx("h2",{className:"text-base md:text-lg font-semibold text-slate-900",children:"Velg behov og fase"}),t.jsxs("div",{className:"mt-3 space-y-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-semibold mb-2",children:"Hva trenger du nå?"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:q.map(e=>{const s=d.includes(e);return t.jsxs("label",{className:`cursor-pointer rounded-lg border px-3 py-2 text-sm transition ${s?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white"}`,children:[t.jsx("input",{type:"checkbox",className:"hidden",checked:s,onChange:()=>T(e)}),e]},e)})})]}),t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsx(N,{onClick:R,disabled:F,children:F?"Lagrer...":"Lagre fase og behov"}),O&&t.jsx("span",{className:"text-xs text-slate-600",children:O})]})]})]}),t.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-4 text-sm",children:[t.jsx("h2",{className:"text-base md:text-lg font-semibold text-slate-900 mb-1",children:i.title}),t.jsx("p",{className:"text-sm text-slate-700 mb-3",children:i.description}),t.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-slate-700",children:i.bullets.map(e=>t.jsx("li",{children:e},e))})]}),t.jsxs("section",{className:"mt-6 rounded-2xl border border-slate-200 bg-white p-4 text-sm",children:[t.jsx("h2",{className:"text-base md:text-lg font-semibold text-slate-900",children:i.diaryTitle}),t.jsx("p",{className:"text-xs text-slate-600 mb-3",children:i.diaryDescription}),t.jsx("div",{className:"mb-3 flex flex-wrap gap-2",children:Object.keys(w).map(e=>{const s=n===e,r=!!D[e]?.trim();return t.jsxs("button",{type:"button",onClick:()=>o(e),className:`px-3 py-1 rounded-full text-xs border flex items-center gap-1 ${s?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300"}`,children:[t.jsx("span",{children:e}),r&&t.jsx("span",{"aria-hidden":"true",className:`inline-block w-1.5 h-1.5 rounded-full ${s?"bg-white/90":"bg-emerald-500"}`})]},e)})}),t.jsx("textarea",{value:n&&D[n]||"",onChange:U,rows:8,className:"w-full rounded-xl border border-slate-300 bg-white p-3 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-200 resize-y",placeholder:i.diaryPlaceholder}),z&&t.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Lagrer ..."}),H&&t.jsx("p",{className:"mt-1 text-xs text-red-500",children:H})]}),t.jsx("h2",{className:"mt-6 text-lg font-semibold text-slate-900",children:"Handlinger (14 dager)"}),t.jsx("ul",{className:"mt-3 space-y-2",children:i.actions.map(e=>t.jsx("li",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-3 text-sm",children:e},e))}),t.jsx("div",{className:"mt-6",children:t.jsx(_,{to:"/resources",className:"block rounded-xl border border-slate-200 bg-white py-3 text-center text-sm font-semibold hover:bg-slate-50",children:"Ressurser"})})]})})}export{ee as default};
