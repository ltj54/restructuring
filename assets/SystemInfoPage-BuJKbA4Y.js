import{r as s,a as I,j as e}from"./index-CQIs3pJx.js";import{C as j}from"./Card-jkGfey-V.js";import{P as F}from"./PageLayout-BPBjxFHi.js";import{m as r}from"./proxy-CKzCJood.js";const D=60,O={initial:{scale:1,opacity:1},animate:{scale:[1,1.12,1],opacity:[1,.7,1],transition:{duration:1.6,repeat:1/0}}};function U({waitingForResponse:t,waitingSecondsLeft:l}){return t?e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40",children:e.jsxs(r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-xl max-w-sm w-full px-6 py-5 text-sm text-slate-800",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:"Venter på svar fra tjenesten..."}),e.jsx("p",{className:"mt-2 text-slate-700",children:"Backend kjører på Render (gratisversjon), og kan bruke litt tid på å starte opp når den har vært inaktiv."}),e.jsxs("p",{className:"mt-3 text-xs text-slate-500",children:["Estimert ventetid:"," ",l!==null?`${l} sekunder`:`${D} sekunder`]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Popupen forsvinner automatisk så snart vi får svar fra tjenesten."})]})}):null}function _({status:t}){const l=t==="ok"?"bg-green-100 text-green-800 border-green-300":t==="feil"?"bg-red-100 text-red-800 border-red-300":"bg-slate-100 text-slate-700 border-slate-300";return e.jsxs(r.div,{variants:O,initial:"initial",animate:"animate",className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm mt-4 ${l}`,"aria-live":"polite",children:[e.jsx("span",{"aria-hidden":"true",className:`h-2.5 w-2.5 rounded-full ${t==="ok"?"bg-green-500":t==="feil"?"bg-red-500":"bg-slate-500"}`}),e.jsx("span",{className:"font-semibold",children:t==="ok"?"Online":t==="feil"?"Offline":"Ukjent"})]})}function z({history:t}){if(t.length===0)return e.jsx("p",{className:"text-sm text-slate-700",children:"Ingen historikk ennå."});const l=t.length>0?Math.max(...t.map(a=>a.durationMs||0),1):1;return e.jsx("div",{className:"space-y-2 text-xs text-slate-700",children:t.map((a,d)=>{const f=a.durationMs?Math.min(100,a.durationMs/l*100):5,o=a.status==="ok"?"bg-green-500":a.status==="feil"?"bg-red-500":"bg-slate-400";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20",children:a.time.toLocaleTimeString()}),e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${o}`,style:{width:`${f}%`}})}),e.jsx("div",{className:"w-16 text-right",children:a.durationMs?`${Math.round(a.durationMs)} ms`:"-"})]},d)})})}function Q(){const[t,l]=s.useState("ukjent"),[a,d]=s.useState(null),[f,o]=s.useState(""),[,b]=s.useState(!1),[v,B]=s.useState(null),[c,h]=s.useState("ukjent"),[H,N]=s.useState(null),[$,m]=s.useState(""),[R,T]=s.useState([]),[E,y]=s.useState(!1),[L,S]=s.useState(null),k=s.useMemo(()=>`${I}/hello`,[]),g=s.useMemo(()=>`${I}/dbinfo`,[]),x=s.useCallback(()=>{y(!0),S(D)},[]),u=s.useCallback(()=>{y(!1),S(null)},[]),w=s.useCallback(async()=>{b(!0),o(""),x();const n=performance.now();let i="ukjent",M=null;try{const p=await fetch(k);M=p.status,d(p.status),p.ok?(i="ok",l("ok"),o("Backend svarer som forventet.")):(i="feil",l("feil"),o("Backend svarte, men med feil."))}catch{i="feil",l("feil"),o("Ingen respons fra backend."),d(null)}finally{u();const W=performance.now()-n;B(new Date),b(!1),T(A=>[{time:new Date,status:i,httpCode:M,durationMs:W},...A].slice(0,10))}},[k,x,u]),C=s.useCallback(async()=>{x(),m("");try{const n=await fetch(g);if(N(n.status),n.ok){const i=await n.text();h("ok"),m(i)}else h("feil"),m("DB-endepunkt svarte, men med feil.")}catch{h("feil"),N(null),m("Ingen respons fra DB-endepunkt.")}finally{u()}},[g,x,u]);s.useEffect(()=>{let n=null;async function i(){if(await w(),t==="ok"&&await C(),t==="ok"&&c==="ok"){n&&clearInterval(n);return}}return i(),n=window.setInterval(i,3e3),()=>{n&&clearInterval(n)}},[t,c,w,C]);const P=c==="ok"?"text-green-700":c==="feil"?"text-red-700":"text-slate-700";return e.jsxs(F,{title:"Systemstatus",subtitle:"Health-check og responstider for backend.",maxWidthClassName:"max-w-6xl",children:[e.jsx(U,{waitingForResponse:E,waitingSecondsLeft:L}),t!=="ok"&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-4 p-4 text-sm text-orange-800 bg-orange-100 border border-orange-300 rounded-xl",children:e.jsx(r.div,{animate:{opacity:[.4,1,.4]},transition:{repeat:1/0,duration:1.5},children:"Starter backend … (Render kan bruke litt tid)"})}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-6",children:[e.jsx(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-2",children:e.jsxs(j,{title:"Backend-status",children:[e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Hello-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:k})]}),e.jsx(_,{status:t}),e.jsxs("p",{className:"mt-3 text-sm text-slate-600",children:["Sist sjekket: ",v?v.toLocaleTimeString():"Aldri"]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["HTTP-kode (hello): ",a??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Melding:"})," ",f]})]})}),e.jsx(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(j,{title:"Detaljert helsesjekk",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:g})]}),e.jsxs("p",{className:`mt-2 ${P}`,children:["Status: ",c==="ok"?"OK":c==="feil"?"Feil":"Ukjent"]}),e.jsxs("p",{className:"text-sm text-slate-700",children:["HTTP-kode (dbinfo): ",H??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-xs text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-melding:"})," ",$||"Ingen sjekk ennå."]})]})})}),e.jsx(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-3",children:e.jsx(j,{title:"Responstid & logg",children:e.jsx(z,{history:R})})})]})]})}export{Q as default};
