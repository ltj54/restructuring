import{r as l,c as h,b as f,g as x,a as b,j as e,L as w}from"./index-DY5-8eit.js";import{u as k,t as y,F as S,T as p}from"./types-DesljOjY.js";import{C as j}from"./Card-CSTHicjx.js";import{B as v}from"./Button-CslG25di.js";import{P}from"./PageLayout-BiITw9I-.js";import{r as R}from"./authSchemas-CKE_z9Ap.js";function C(){const[c,s]=l.useState(null),[m,u]=l.useState(null),[n,o]=l.useState(!1),r=h(),i=k({resolver:y(R),defaultValues:{email:"",password:"",repeatPassword:""},mode:"onTouched"});l.useEffect(()=>{let a=!0;return(async()=>{try{const t=await fetch(`${f}/hello`);if(!a)return;t.ok&&u(await t.text())}catch{a&&u(null)}})(),()=>{a=!1}},[]);const g=l.useMemo(()=>i.handleSubmit(async a=>{s(null),o(!0);try{const t=await fetch(`${f}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.email,password:a.password})}),d=await t.json().catch(()=>({}));if(!t.ok){s({variant:"error",message:typeof d.message=="string"?d.message:"Noe gikk galt ved registrering."});return}s({variant:"success",message:"Bruker registrert! Du kan nå logge inn."}),r("/login",{replace:!0})}catch(t){s({variant:"error",message:x(t,"Kunne ikke koble til serveren.")})}finally{o(!1)}}),[i,r]);return{form:i,feedback:c,apiMessage:m,isSubmitting:n,onSubmit:g}}function A(){const{form:c,feedback:s,isSubmitting:m,onSubmit:u}=C(),{register:n,formState:{errors:o}}=c,r=b(),i=h(),a=new URLSearchParams(r.search).get("redirect")||"/insurance";return e.jsx(P,{title:"Registrer konto",subtitle:"Opprett en konto for å lagre plan og fremdrift.",maxWidthClassName:"max-w-xl",children:e.jsxs(j,{children:[s&&e.jsx(S,{variant:s.variant,message:s.message,action:s.action}),e.jsxs("form",{onSubmit:c.handleSubmit(async t=>{await u(t)&&i(a,{replace:!0})}),className:"flex flex-col gap-5 mt-4",children:[e.jsx(p,{type:"email",label:"E-post",placeholder:"E-post",error:o.email?.message,autoComplete:"email",...n("email")}),e.jsx(p,{type:"password",label:"Passord",placeholder:"Passord",autoComplete:"new-password",error:o.password?.message,...n("password")}),e.jsx(p,{type:"password",label:"Gjenta passord",placeholder:"Gjenta passord",autoComplete:"new-password",error:o.repeatPassword?.message,...n("repeatPassword")}),e.jsx(v,{type:"submit",disabled:m,children:m?"Registrerer.":"Registrer"}),e.jsx("div",{className:"text-center mt-1",children:e.jsx(w,{to:`/login?redirect=${encodeURIComponent(r.pathname+r.search+r.hash)}`,className:"text-sm text-slate-600 hover:text-brand-dark hover:underline",children:"Har du konto? Logg inn"})})]})]})})}export{A as default};
