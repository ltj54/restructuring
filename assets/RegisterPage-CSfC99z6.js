import{r as n,a as u,g as x,j as e,L as h}from"./index-BHhJI5KT.js";import{u as b,t as w,F as f,T as g}from"./types-B7pUikB3.js";import{C as k}from"./Card-CPJa0U6w.js";import{B as j}from"./Button-DPtfrP6g.js";import{r as y}from"./authSchemas-BGOQ-NMa.js";import{P as S}from"./PageLayout-DeuinnMT.js";function P(){const[d,r]=n.useState(null),[l,i]=n.useState(null),[p,o]=n.useState(!1),t=b({resolver:w(y),defaultValues:{email:"",password:"",repeatPassword:""},mode:"onTouched"});n.useEffect(()=>{let a=!0;return(async()=>{try{const s=await fetch(`${u}/hello`);if(!a)return;s.ok&&i(await s.text())}catch{a&&i(null)}})(),()=>{a=!1}},[]);const m=n.useMemo(()=>t.handleSubmit(async a=>{r(null),o(!0);try{const s=await fetch(`${u}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.email,password:a.password})}),c=await s.json().catch(()=>({}));if(!s.ok){r({variant:"error",message:typeof c.message=="string"?c.message:"Noe gikk galt ved registrering."});return}r({variant:"success",message:"Bruker registrert! Du kan nå logge inn."}),t.reset({email:"",password:"",repeatPassword:""})}catch(s){r({variant:"error",message:x(s,"Kunne ikke koble til serveren.")})}finally{o(!1)}}),[t]);return{form:t,feedback:d,apiMessage:l,isSubmitting:p,onSubmit:m}}function L(){var m,a,s;const{form:d,feedback:r,apiMessage:l,isSubmitting:i,onSubmit:p}=P(),{register:o,formState:{errors:t}}=d;return e.jsx(S,{title:"Registrer deg",subtitle:"Lagre plan, dagbok og beregninger på din bruker.",maxWidthClassName:"max-w-xl",children:e.jsxs(k,{children:[l&&e.jsx(f,{variant:"info",message:l}),r&&e.jsx(f,{variant:r.variant,message:r.message,action:r.action}),e.jsxs("form",{onSubmit:p,className:"flex flex-col gap-5 mt-4",children:[e.jsx(g,{type:"email",label:"E-post",placeholder:"E-post",autoComplete:"email",error:(m=t.email)==null?void 0:m.message,...o("email")}),e.jsx(g,{type:"password",label:"Passord",placeholder:"Passord",autoComplete:"new-password",error:(a=t.password)==null?void 0:a.message,...o("password")}),e.jsx(g,{type:"password",label:"Bekreft passord",placeholder:"Bekreft passord",autoComplete:"new-password",error:(s=t.repeatPassword)==null?void 0:s.message,...o("repeatPassword")}),e.jsx(j,{type:"submit",disabled:i,children:i?"Registrerer...":"Registrer"})]}),e.jsxs("p",{className:"mt-6 text-center text-sm text-slate-600",children:["Har du allerede en konto?"," ",e.jsx(h,{to:"/login",className:"text-brand-dark font-medium hover:underline",children:"Logg inn her"}),"."]})]})})}export{L as default};
