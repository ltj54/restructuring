import{u as S,r as o,f as y,g as x,A as b,a as E,j as e}from"./index-CKMgu8cZ.js";import{o as F,s as j,u as I,t as P,F as L,T as v}from"./types-G_kP4QRs.js";import{C as N}from"./Card-oOArJDDQ.js";import{B as w}from"./Button-B3TmYlrb.js";function C(){const{isAuthenticated:r,refreshUser:l}=S(),[n,s]=o.useState({firstName:"",lastName:"",ssn:""}),[g,m]=o.useState(!0),[k,t]=o.useState(!1),[c,d]=o.useState(null),a=o.useCallback(async()=>{m(!0),d(null);try{if(!r){m(!1);return}const f=await y("/user/me");s({firstName:f.firstName??"",lastName:f.lastName??"",ssn:f.ssn??""})}catch(f){d(x(f,"Klarte ikke å hente brukerdata."))}finally{m(!1)}},[r]);o.useEffect(()=>{a()},[a]);const i=o.useCallback(async f=>{const u={firstName:f.firstName.trim(),lastName:f.lastName.trim(),ssn:f.ssn.trim()};if(!u.firstName||!u.lastName||!u.ssn)throw new b("Fyll inn alle feltene før du lagrer.",400);t(!0),d(null);try{await y("/user/me",{method:"PUT",body:u}),s(u),await l()}catch(p){throw d(x(p,"Kunne ikke lagre informasjon.")),p}finally{t(!1)}},[l]),h=o.useMemo(()=>!n.firstName.trim()||!n.lastName.trim()||!n.ssn.trim(),[n.firstName,n.lastName,n.ssn]);return{profile:n,isLoading:g,isSaving:k,error:c,needsInfo:h,saveProfile:i,refresh:a}}function U(r){const n=(r.headers.get("Content-Disposition")??"").match(/filename\*=UTF-8''(.+)|filename="?([^";]+)"?/i);if(!n)return"insurance_request.xml";const[,s,g]=n;if(s)try{return decodeURIComponent(s)}catch{return s}return g??"insurance_request.xml"}function A(r,l){const n=window.URL.createObjectURL(r),s=document.createElement("a");s.href=n,s.download=l,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(n)}function R(){const{isAuthenticated:r,token:l}=S(),[n,s]=o.useState(!1),[g,m]=o.useState(null),k=o.useCallback(async()=>{if(!r||!l)throw new b("Du må være innlogget for å sende søknaden.",401);s(!0),m(null);try{const t=await fetch(`${E}/insurance/send`,{method:"POST",headers:{Authorization:`Bearer ${l}`}});if(!t.ok){let a=`Request failed with status ${t.status}`;try{const i=await t.json();i&&typeof i=="object"&&"message"in i&&typeof i.message=="string"&&(a=i.message)}catch{try{const i=await t.text();i&&(a=i)}catch{}}throw new b(a,t.status)}const c=await t.blob(),d=U(t);return A(c,d),"Forsikringssøknad generert og lastet ned."}catch(t){const c=x(t);throw m(c),t instanceof Error?t:new b(c,500)}finally{s(!1)}},[r,l]);return{isSending:n,error:g,sendInsurance:k}}const T=F({firstName:j().min(1,"Fornavn er påkrevd"),lastName:j().min(1,"Etternavn er påkrevd"),ssn:j().regex(/^\d{11}$/,"Fødselsnummer må være 11 siffer")});function B(){const{profile:r,isLoading:l,isSaving:n,error:s,needsInfo:g,saveProfile:m}=C(),{isSending:k,error:t,sendInsurance:c}=R(),[d,a]=o.useState(null),i=I({resolver:P(T),defaultValues:{firstName:r.firstName,lastName:r.lastName,ssn:r.ssn},mode:"onTouched"});o.useEffect(()=>{i.reset({firstName:r.firstName,lastName:r.lastName,ssn:r.ssn})},[i,r]),o.useEffect(()=>{s&&a({variant:"error",message:s})},[s]),o.useEffect(()=>{t&&a({variant:"error",message:t})},[t]);const h=o.useMemo(()=>i.handleSubmit(async u=>{a(null);try{await m(u),a({variant:"success",message:"Informasjon lagret. Du kan nå sende søknaden."})}catch(p){a({variant:"error",message:x(p,"Klarte ikke å lagre informasjon. Prøv igjen.")})}}),[i,m]),f=o.useCallback(async()=>{a(null);try{const u=await c();a({variant:"success",message:u})}catch(u){a({variant:"error",message:x(u,"Kunne ikke generere forsikringssøknad.")})}},[c]);return{form:i,banner:d,isLoading:l,isSaving:n,isSending:k,needsInfo:g,onSaveProfile:h,onSendInsurance:f}}function K(){var a,i,h;const{form:r,banner:l,isLoading:n,isSaving:s,isSending:g,needsInfo:m,onSaveProfile:k,onSendInsurance:t}=B(),{register:c,formState:{errors:d}}=r;return n?e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 py-10 text-center text-slate-700",children:"Laster..."}):e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 py-10 space-y-6",children:[l&&e.jsx(L,{variant:l.variant,message:l.message,action:l.action}),m&&e.jsxs(N,{title:"Fyll ut manglende opplysninger",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"For å sende inn forsikringssøknad må vi vite hvem du er."}),e.jsxs("form",{onSubmit:k,className:"flex flex-col gap-4",children:[e.jsx(v,{label:"Fornavn",placeholder:"Fornavn",error:(a=d.firstName)==null?void 0:a.message,autoComplete:"given-name",...c("firstName")}),e.jsx(v,{label:"Etternavn",placeholder:"Etternavn",error:(i=d.lastName)==null?void 0:i.message,autoComplete:"family-name",...c("lastName")}),e.jsx(v,{label:"Fødselsnummer",placeholder:"Fødselsnummer (11 siffer)",error:(h=d.ssn)==null?void 0:h.message,inputMode:"numeric",autoComplete:"off",...c("ssn")}),e.jsx(w,{type:"submit",disabled:s,children:s?"Lagrer...":"Lagre informasjon"})]})]}),!m&&e.jsxs(N,{title:"Forsikring",children:[e.jsx("p",{className:"text-slate-700 mb-6 text-sm md:text-base",children:"Her kan du sende inn din forsikringssøknad. Når du klikker på knappen under, genereres en XML-fil som sendes til forsikringsselskapet."}),e.jsx(w,{onClick:t,disabled:g,children:g?"Sender...":"Send søknad om forsikring"})]}),e.jsxs(N,{title:"Forsikring mot inntektsbortfall",children:[e.jsx("p",{className:"mb-4 text-sm md:text-base text-slate-700",children:"Forsikring mot inntektsbortfall gir økonomisk trygghet hvis du mister inntekten - for eksempel ved sykdom, uførhet, permittering eller arbeidsledighet."}),e.jsx("h3",{className:"text-lg font-semibold mt-6 mb-2 text-brand-dark",children:"Vanlige typer forsikringer"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-sm md:text-base text-slate-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Uføreforsikring:"})," Gir månedlig utbetaling ved uførhet."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Inntektsforsikring:"})," Gir støtte ved arbeidsledighet/permittering."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Yrkesskadeforsikring:"})," Dekker skader/sykdom relatert til jobb."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Livsforsikring:"})," Engangsutbetaling til etterlatte ved dødsfall."]})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6 mb-2 text-brand-dark",children:"Husk å sjekke"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-sm md:text-base text-slate-700",children:[e.jsx("li",{children:"Hva forsikringen faktisk dekker"}),e.jsx("li",{children:"Hvor mye og hvor lenge du får utbetalt"}),e.jsx("li",{children:"Skatt - en del er skattepliktig"}),e.jsx("li",{children:"Vilkår: karens, unntak, egenandel"})]})]})]})}export{K as default};
