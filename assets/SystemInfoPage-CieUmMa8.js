import{r as s,a as S,j as e}from"./index-Bh59JvDE.js";import{C as k}from"./Card-DqcWPzmy.js";import{P as L}from"./PageLayout-CPxwJDkf.js";import{m as c}from"./proxy-_YY1rdG6.js";const P={initial:{scale:1,opacity:1},animate:{scale:[1,1.12,1],opacity:[1,.7,1],transition:{duration:1.6,repeat:1/0}}};function T({status:t}){const i=t==="ok"?"bg-green-100 text-green-800 border-green-300":t==="feil"?"bg-red-100 text-red-800 border-red-300":"bg-slate-100 text-slate-700 border-slate-300";return e.jsxs(c.div,{variants:P,initial:"initial",animate:"animate",className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm mt-4 ${i}`,"aria-live":"polite",children:[e.jsx("span",{"aria-hidden":"true",className:`h-2.5 w-2.5 rounded-full ${t==="ok"?"bg-green-500":t==="feil"?"bg-red-500":"bg-slate-500"}`}),e.jsx("span",{className:"font-semibold",children:t==="ok"?"Online":t==="feil"?"Offline":"Ukjent"})]})}function U({history:t}){if(t.length===0)return e.jsx("p",{className:"text-sm text-slate-700",children:"Ingen historikk ennå."});const i=t.length>0?Math.max(...t.map(a=>a.durationMs||0),1):1;return e.jsx("div",{className:"space-y-2 text-xs text-slate-700",children:t.map((a,d)=>{const u=a.durationMs?Math.min(100,a.durationMs/i*100):5,r=a.status==="ok"?"bg-green-500":a.status==="feil"?"bg-red-500":"bg-slate-400";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20",children:a.time.toLocaleTimeString()}),e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${r}`,style:{width:`${u}%`}})}),e.jsx("div",{className:"w-16 text-right",children:a.durationMs?`${Math.round(a.durationMs)} ms`:"-"})]},d)})})}function F(){const[t,i]=s.useState("ukjent"),[a,d]=s.useState(null),[u,r]=s.useState(""),[,g]=s.useState(!1),[j,w]=s.useState(null),[o,p]=s.useState("ukjent"),[C,b]=s.useState(null),[M,m]=s.useState(""),[I,D]=s.useState([]),f=s.useMemo(()=>`${S}/hello`,[]),h=s.useMemo(()=>`${S}/dbinfo`,[]),N=s.useCallback(async()=>{g(!0),r("");const n=performance.now();let l="ukjent",v=null;try{const x=await fetch(f);v=x.status,d(x.status),x.ok?(l="ok",i("ok"),r("Backend svarer som forventet.")):(l="feil",i("feil"),r("Backend svarte, men med feil."))}catch{l="feil",i("feil"),r("Ingen respons fra backend."),d(null)}finally{const H=performance.now()-n;w(new Date),g(!1),D($=>[{time:new Date,status:l,httpCode:v,durationMs:H},...$].slice(0,10))}},[f]),y=s.useCallback(async()=>{m("");try{const n=await fetch(h);if(b(n.status),n.ok){const l=await n.text();p("ok"),m(l)}else p("feil"),m("DB-endepunkt svarte, men med feil.")}catch{p("feil"),b(null),m("Ingen respons fra DB-endepunkt.")}},[h]);s.useEffect(()=>{let n=null;async function l(){if(await N(),t==="ok"&&await y(),t==="ok"&&o==="ok"){n&&clearInterval(n);return}}return l(),n=window.setInterval(l,3e3),()=>{n&&clearInterval(n)}},[t,o,N,y]);const B=o==="ok"?"text-green-700":o==="feil"?"text-red-700":"text-slate-700";return e.jsxs(L,{title:"Systemstatus",subtitle:"Health-check og responstider for backend.",maxWidthClassName:"max-w-6xl",children:[t!=="ok"&&e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-4 p-4 text-sm text-orange-800 bg-orange-100 border border-orange-300 rounded-xl",children:e.jsx(c.div,{animate:{opacity:[.3,1,.3]},transition:{repeat:1/0,duration:1.4},children:"Starter backend … (Render kan bruke litt tid)"})}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-6",children:[e.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-2",children:e.jsxs(k,{title:"Backend-status",children:[e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Hello-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:f})]}),e.jsx(T,{status:t}),e.jsxs("p",{className:"mt-3 text-sm text-slate-600",children:["Sist sjekket: ",j?j.toLocaleTimeString():"Aldri"]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["HTTP-kode (hello): ",a??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Melding:"})," ",u]})]})}),e.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(k,{title:"Detaljert helsesjekk",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:h})]}),e.jsxs("p",{className:`mt-2 ${B}`,children:["Status: ",o==="ok"?"OK":o==="feil"?"Feil":"Ukjent"]}),e.jsxs("p",{className:"text-sm text-slate-700",children:["HTTP-kode (dbinfo): ",C??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-xs text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-melding:"})," ",M||"Ingen sjekk ennå."]})]})})}),e.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-3",children:e.jsx(k,{title:"Responstid & logg",children:e.jsx(U,{history:I})})})]})]})}export{F as default};
