import{a as J,u as _,r,f as P,j as t,L as Q}from"./index-B63jn-9A.js";import{C as W}from"./Card-DSd5nGGm.js";import{B as N}from"./Button-C2JS7oVo.js";import{P as q}from"./PageLayout-P7jEAbkL.js";const w={"Før omstilling":{title:"Før omstilling - bygg trygghet tidlig",description:"Du er i en tidlig fase. Målet nå er å skaffe oversikt og forberede deg uten unødig stress.",bullets:["Skriv ned hva som bekymrer deg konkret - ikke bare «omstilling generelt».","Finn ut hvem som faktisk vet hva (leder, HR, tillitsvalgt).","Sjekk hvilke forsikringer og ordninger du allerede har."],diaryTitle:"Dagbok - før omstilling",diaryDescription:"Skriv ned bekymringer, spørsmål og hva du bør sjekke tidlig.",diaryPlaceholder:"Hva lurer du på nå? Hva trenger du svar på? Hva bekymrer deg?",actions:["Lag liste over hva du vet - og hva du ikke vet.","Ta kontakt med leder eller HR for avklaringer.","Kartlegg dine forsikringer og økonomi.","Begynn stille med oppdatering av CV."]},"Under omstilling":{title:"Under omstilling - ta kontroll på endringene",description:"Endringene er i gang. Her handler planen om å beholde oversikt og bruke rettighetene dine aktivt.",bullets:["Sørg for skriftlig informasjon om forslagene som gjelder deg.","Be om et konkret møte om din rolle og dine alternativer.","Lag et regneark med «nå» og «etter omstilling» for lønn og arbeidstid."],diaryTitle:"Dagbok - under omstilling",diaryDescription:"Skriv ned punkter fra møter, frister og ting du må følge opp.",diaryPlaceholder:"Hva ble sagt i møtet? Hva må du følge opp? Hvilke frister kom opp?",actions:["Be om alt skriftlig.","Lag oversikt over konsekvenser (lønn, arbeidstid, arbeidsoppgaver).","Book rådgiving (tillitsvalgt/HR).","Loggfør alle møter i dagboken."]},"Etter omstilling":{title:"Etter omstilling - juster økonomi og kurs",description:"Omstillingen er gjennomført. Nå handler det om økonomi, karriere og neste steg.",bullets:["Oppdater budsjett basert på ny inntekt og arbeidstid.","Lag en 3-måneders plan for kompetanse, CV og søknader.","Vurder behov for ekstra inntektssikring."],diaryTitle:"Dagbok - etter omstilling",diaryDescription:"Bruk notater til å planlegge neste steg: karriere, økonomi og mål.",diaryPlaceholder:"Hva er neste steg? Hvilke jobber vurderer du? Hva er målene dine?",actions:["Oppdater budsjett.","Planlegg kurs eller kompetanseheving.","Søk på jobber eller interne muligheter.","Lag en 3-måneders utviklingsplan."]}},x=["Før omstilling","Under omstilling","Etter omstilling"],G=["Få oversikt over rettigheter og avtaler","Forstå hva omstillingen betyr for lønn og økonomi","Planlegge neste karrieresteg","Snakke med noen om situasjonen","Få kontroll på forsikringer og inntektssikring"],c=g=>g?g==="For omstilling"?"Før omstilling":g:x[0];function te(){const g=J(),{isAuthenticated:u}=_(),m=new URLSearchParams(g.search).get("phase")??"",[b,k]=r.useState(null),[D,L]=r.useState({}),[n,i]=r.useState(""),[I,v]=r.useState(!1),[z,E]=r.useState(!1),[H,A]=r.useState(null),[h,p]=r.useState(x[0]),[d,y]=r.useState([]),[O,f]=r.useState(null),[F,j]=r.useState(!1),B=n||h||x[0],o=w[B]??w[x[0]];r.useEffect(()=>{const e=localStorage.getItem("myPlan");if(e)try{const s=JSON.parse(e),a=c(s.phase);p(a),s.needs&&y(s.needs),(s.persona||s.phase||s.needs)&&k(l=>l??{persona:s.persona??"Annet",fase:a,behov:s.needs??[],createdAt:new Date().toISOString()}),i(l=>l||a)}catch{}},[]),r.useEffect(()=>{n||i(h)},[n,h]),r.useEffect(()=>{if(m){const e=c(m);p(e),i(e)}},[m]),r.useEffect(()=>{u&&(v(!0),(async()=>{try{const e=await P("/plan/me");if(!e){v(!1);return}const s=c(e.phase),a=e.phase?{persona:e.persona??"Annet",fase:s,behov:e.needs??[],createdAt:e.createdAt??new Date().toISOString()}:null;k(a),p(s),y(e.needs??[]);const l={...e.diaries};e.phase&&e.diary&&!l[e.phase]&&(l[e.phase]=e.diary);const C={};if(Object.entries(l).forEach(([S,$])=>{C[c(S)]=$}),L(C),!n){const S=c(m||e.phase);i(S)}}catch{}finally{v(!1)}})())},[u,n,m]);const T=e=>{p(e),i(e)},R=e=>{y(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e])},U=async()=>{f(null);const e=c(h),s=b?.persona??"Annet",a={persona:s,fase:e,behov:d,createdAt:b?.createdAt??new Date().toISOString()};if(j(!0),k(a),i(l=>l||e),localStorage.setItem("myPlan",JSON.stringify({persona:s,phase:e,needs:d})),localStorage.setItem("personaLabel",s),u)try{await P("/plan/me",{method:"PUT",body:{persona:s,phase:e,needs:d}}),f("Planen er lagret.")}catch{f("Kunne ikke lagre hos serveren, men planen er lagret lokalt.")}finally{j(!1)}else j(!1),f("Planen er lagret lokalt.")},M=e=>{const s=e.target.value;A(null),n&&(L(a=>({...a,[n]:s})),u&&(E(!0),(async()=>{try{const a=d.length?d:b?.behov??[];await P("/plan/me",{method:"PUT",body:{persona:b?.persona??"Annet",phase:n,needs:a,diary:s}})}catch{A("Kunne ikke lagre endringen nå.")}finally{E(!1)}})()))},V=t.jsxs(t.Fragment,{children:[t.jsx(N,{to:"/wizard",className:"bg-gradient-to-r from-emerald-400 to-teal-500 text-slate-900 border-transparent font-semibold",children:"Start veiviseren"}),t.jsx(N,{to:"/resources",className:"bg-white text-emerald-700 border-emerald-200 hover:bg-emerald-50 font-semibold",children:"Se ressurser"})]});return t.jsx(q,{title:"Min plan",subtitle:"Fire steg som gir deg oversikt: fase, økonomi, kompetanse og konkrete handlinger.",actions:V,maxWidthClassName:"max-w-5xl",children:t.jsxs(W,{children:[I&&t.jsx("p",{className:"mb-3 text-xs text-slate-500",children:"Laster plan ..."}),t.jsxs("section",{className:"mb-6 rounded-2xl border border-slate-200 bg-white p-4 text-sm",children:[t.jsx("h2",{className:"text-base md:text-lg font-semibold text-slate-900",children:"Velg fase og behov"}),t.jsxs("div",{className:"mt-3 space-y-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-semibold mb-2",children:"Fase"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(e=>{const s=h===e;return t.jsx("button",{type:"button",onClick:()=>T(e),className:`px-3 py-2 rounded-full text-xs border ${s?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300"}`,children:e},e)})})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-semibold mb-2",children:"Hva trenger du nå?"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:G.map(e=>{const s=d.includes(e);return t.jsxs("label",{className:`cursor-pointer rounded-lg border px-3 py-2 text-sm transition ${s?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white"}`,children:[t.jsx("input",{type:"checkbox",className:"hidden",checked:s,onChange:()=>R(e)}),e]},e)})})]}),t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsx(N,{onClick:U,disabled:F,children:F?"Lagrer...":"Lagre fase og behov"}),O&&t.jsx("span",{className:"text-xs text-slate-600",children:O})]})]})]}),t.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-4 text-sm",children:[t.jsx("h2",{className:"text-base md:text-lg font-semibold text-slate-900 mb-1",children:o.title}),t.jsx("p",{className:"text-sm text-slate-700 mb-3",children:o.description}),t.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-slate-700",children:o.bullets.map(e=>t.jsx("li",{children:e},e))})]}),t.jsxs("section",{className:"mt-6 rounded-2xl border border-slate-200 bg-white p-4 text-sm",children:[t.jsx("h2",{className:"text-base md:text-lg font-semibold text-slate-900",children:o.diaryTitle}),t.jsx("p",{className:"text-xs text-slate-600 mb-3",children:o.diaryDescription}),t.jsx("div",{className:"mb-3 flex flex-wrap gap-2",children:Object.keys(w).map(e=>{const s=n===e,a=!!D[e]?.trim();return t.jsxs("button",{type:"button",onClick:()=>i(e),className:`px-3 py-1 rounded-full text-xs border flex items-center gap-1 ${s?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300"}`,children:[t.jsx("span",{children:e}),a&&t.jsx("span",{"aria-hidden":"true",className:`inline-block w-1.5 h-1.5 rounded-full ${s?"bg-white/90":"bg-emerald-500"}`})]},e)})}),t.jsx("textarea",{value:n&&D[n]||"",onChange:M,rows:8,className:"w-full rounded-xl border border-slate-300 bg-white p-3 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-200 resize-y",placeholder:o.diaryPlaceholder}),z&&t.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Lagrer ..."}),H&&t.jsx("p",{className:"mt-1 text-xs text-red-500",children:H})]}),t.jsx("h2",{className:"mt-6 text-lg font-semibold text-slate-900",children:"Handlinger (14 dager)"}),t.jsx("ul",{className:"mt-3 space-y-2",children:o.actions.map(e=>t.jsx("li",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-3 text-sm",children:e},e))}),t.jsx("div",{className:"mt-6",children:t.jsx(Q,{to:"/resources",className:"block rounded-xl border border-slate-200 bg-white py-3 text-center text-sm font-semibold hover:bg-slate-50",children:"Ressurser"})})]})})}export{te as default};
