import{r as d,a as u,g as f,d as g,j as e,L as k}from"./index-Cc-pA_wX.js";import{u as x,t as h,F as b,T as c}from"./types-BjoCJgRi.js";import{C as w}from"./Card-BGGoywET.js";import{B as y}from"./Button-BUXopYbD.js";import{a as S}from"./authSchemas-DAHJ9gAS.js";import{P as j}from"./PageLayout-BLU7QnO0.js";function P(t){const[m,r]=d.useState(()=>t?null:{variant:"error",message:"Ugyldig eller manglende tilbakestillingslenke."}),[a,n]=d.useState(!1),s=x({resolver:h(S),defaultValues:{token:t,password:"",confirm:""},mode:"onTouched"});d.useEffect(()=>{s.setValue("token",t,{shouldValidate:!0,shouldDirty:!1})},[s,t]);const i=d.useMemo(()=>s.handleSubmit(async o=>{r(null),n(!0);try{(await fetch(`${u}/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:o.token,password:o.password})})).ok?(r({variant:"success",message:"Passordet er oppdatert! Du kan nå logge inn."}),s.reset({token:o.token,password:"",confirm:""})):r({variant:"error",message:"Kunne ikke oppdatere passordet. Lenken kan være utløpt."})}catch(l){r({variant:"error",message:f(l,"Ingen kontakt med serveren.")})}finally{n(!1)}}),[s]);return{form:s,feedback:m,isSubmitting:a,onSubmit:i}}function E(){var l,p;const[t]=g(),m=t.get("token")||"",{form:r,feedback:a,isSubmitting:n,onSubmit:s}=P(m),{register:i,formState:{errors:o}}=r;return e.jsx(j,{title:"Tilbakestill passord",subtitle:"Sett et nytt passord for å komme videre.",maxWidthClassName:"max-w-xl",children:e.jsxs(w,{children:[a&&e.jsx(b,{variant:a.variant,message:a.message,action:a.action}),e.jsxs("form",{onSubmit:s,className:"flex flex-col gap-5",children:[e.jsx("input",{type:"hidden",...i("token")}),e.jsx(c,{type:"password",label:"Nytt passord",placeholder:"Nytt passord",autoComplete:"new-password",error:(l=o.password)==null?void 0:l.message,...i("password")}),e.jsx(c,{type:"password",label:"Bekreft nytt passord",placeholder:"Bekreft nytt passord",autoComplete:"new-password",error:(p=o.confirm)==null?void 0:p.message,...i("confirm")}),e.jsx(y,{type:"submit",disabled:n,children:n?"Oppdaterer.":"Oppdater passord"})]}),e.jsx("p",{className:"mt-6 text-center text-sm text-slate-600",children:e.jsx(k,{to:"/login",className:"text-brand-dark font-medium hover:underline",children:"Tilbake til innlogging"})})]})})}export{E as default};
