import{r as l,b as C,j as e}from"./index-BTLUZozR.js";import{C as b}from"./Card-C-km7Xwu.js";import{P}from"./PageLayout-SBILuhi2.js";import{m as o}from"./proxy-BC_KD75i.js";function E(){return e.jsx(o.div,{className:"mr-2 inline-block h-4 w-4 rounded-full border-2 border-amber-600 border-t-transparent",animate:{rotate:360},transition:{repeat:1/0,duration:.8,ease:"linear"}})}function a({width:s="100%",height:i="1rem"}){return e.jsx("div",{className:"animate-pulse rounded bg-slate-200/80",style:{width:s,height:i}})}function M(){return e.jsxs("div",{className:"space-y-3 rounded-xl bg-slate-50 p-3",children:[e.jsx(a,{width:"55%"}),e.jsx(a,{width:"35%"}),e.jsx(a,{width:"90%",height:"0.75rem"}),e.jsx(a,{width:"75%",height:"0.75rem"}),e.jsx(a,{width:"50%",height:"0.75rem"})]})}function U({status:s}){const i=s==="ok"?"bg-emerald-100 text-emerald-800 border-emerald-300":s==="feil"?"bg-rose-100 text-rose-800 border-rose-300":"bg-slate-100 text-slate-700 border-slate-300";return e.jsxs("div",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm ${i}`,children:[e.jsx("span",{"aria-hidden":"true",className:`h-2.5 w-2.5 rounded-full ${s==="ok"?"bg-emerald-500":s==="feil"?"bg-rose-500":"bg-slate-500"}`}),e.jsx("span",{className:"font-semibold",children:s==="ok"?"Online":s==="feil"?"Offline":"Ukjent"})]})}function O({history:s}){if(s.length===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{width:"30%"}),e.jsx(a,{width:"90%",height:"0.5rem"}),e.jsx(a,{width:"85%",height:"0.5rem"}),e.jsx(a,{width:"70%",height:"0.5rem"})]});const i=s.length>0?Math.max(...s.map(t=>t.durationMs||0),1):1;return e.jsx("div",{className:"space-y-3 text-sm text-slate-700",children:s.map((t,m)=>{const h=t.durationMs?Math.min(100,t.durationMs/i*100):5,c=t.status==="ok"?"bg-emerald-500":t.status==="feil"?"bg-rose-500":"bg-slate-400";return e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-white/80 p-3 shadow-sm shadow-slate-100",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsx("span",{children:t.time.toLocaleTimeString()}),e.jsx("span",{className:"font-semibold text-slate-700",children:t.durationMs?`${Math.round(t.durationMs)} ms`:"Ingen måling"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 overflow-hidden rounded-full bg-slate-200",children:e.jsx("div",{className:`h-2 ${c}`,style:{width:`${h}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${t.status==="ok"?"bg-emerald-500":t.status==="feil"?"bg-rose-500":"bg-slate-400"}`}),e.jsx("span",{className:"uppercase tracking-wide text-slate-600",children:t.status==="ok"?"OK":t.status==="feil"?"FEIL":"UKJENT"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["HTTP: ",t.httpCode??"-"]})]},m)})})}function J(){const[s,i]=l.useState("ukjent"),[t,m]=l.useState(null),[h,c]=l.useState(""),[,k]=l.useState(!1),[N,I]=l.useState(null),[d,u]=l.useState("ukjent"),[B,w]=l.useState(null),[D,x]=l.useState(""),[j,H]=l.useState([]);j[0];const p=l.useMemo(()=>`${C}/health`,[]),f=l.useMemo(()=>`${C}/dbinfo`,[]),v=l.useCallback(async()=>{k(!0),c("");const n=performance.now();let r="ukjent";try{const g=await fetch(p);m(g.status),g.ok?(r="ok",i("ok"),c("Backend svarer som forventet.")):(r="feil",i("feil"),c("Backend svarte, men med feil."))}catch{r="feil",i("feil"),c("Ingen respons fra backend."),m(null)}finally{const $=performance.now()-n;I(new Date),k(!1),H(L=>[{time:new Date,status:r,httpCode:t,durationMs:$},...L].slice(0,10))}},[p,t]),y=l.useCallback(async()=>{x("");try{const n=await fetch(f);if(w(n.status),n.ok){const r=await n.text();u("ok"),x(r)}else u("feil"),x("DB-endepunkt svarte, men med feil.")}catch{u("feil"),w(null),x("Ingen respons fra DB-endepunkt.")}},[f]);l.useEffect(()=>{let n=null;async function r(){if(await v(),s==="ok"&&await y(),s==="ok"&&d==="ok"){n&&clearInterval(n);return}}return r(),n=window.setInterval(r,3e3),()=>n&&clearInterval(n)},[s,d,v,y]);const S=s!=="ok",T=d==="ok"?"text-green-700":d==="feil"?"text-red-700":"text-slate-700";return e.jsxs(P,{title:"Systemstatus",subtitle:"Health-check og responstider for backend.",maxWidthClassName:"max-w-6xl",children:[S&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:[.45,1,.45]},transition:{duration:1.8,repeat:1/0},className:"mb-4 p-3 text-sm text-yellow-900 bg-yellow-100 border border-yellow-300 rounded-xl flex items-center",children:[e.jsx(E,{}),"Backend vil starte snart (kanskje)…"]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-6",children:[e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-2",children:e.jsxs(b,{title:"Backend-status",children:[e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Health-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:p})]}),S?e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(a,{width:"30%",height:"1.5rem"}),e.jsx(M,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{status:s}),e.jsxs("p",{className:"mt-3 text-sm text-slate-600",children:["Sist sjekket: ",N?N.toLocaleTimeString():"Aldri"]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["HTTP-kode (health): ",t??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Melding:"})," ",h]})]})]})}),e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(b,{title:"Database-status",children:d==="ok"?e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:f})]}),e.jsxs("p",{className:`mt-2 ${T}`,children:["Status: ",d==="ok"?"OK":d==="feil"?"Feil":"Ukjent"]}),e.jsxs("p",{className:"text-sm text-slate-700",children:["HTTP-kode (dbinfo): ",B??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-xs text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-melding:"})," ",D||"Ingen sjekk ennå."]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(a,{width:"50%"}),e.jsx(a,{width:"30%"}),e.jsx(M,{})]})})}),e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-3",children:e.jsx(b,{title:"Responstid og logg",children:j.length===0?e.jsxs("div",{className:"space-y-3",children:[e.jsx(a,{width:"70%",height:"0.75rem"}),e.jsx(a,{width:"60%",height:"0.75rem"}),e.jsx(a,{width:"50%",height:"0.75rem"})]}):e.jsx(O,{history:j})})})]})]})}export{J as default};
