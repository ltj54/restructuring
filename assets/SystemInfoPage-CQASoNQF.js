import{r as t,a as B,j as e}from"./index-D05Wi4Cc.js";import{C as v}from"./Card-CJMmiDPP.js";import{P as z}from"./PageLayout-Dlj7iBUq.js";import{m as i}from"./proxy-B4DM27lh.js";const H=60,V={initial:{scale:1,opacity:1},animate:{scale:[1,1.12,1],opacity:[1,.7,1],transition:{duration:1.6,repeat:1/0}}};function Y(){const[n,f]=t.useState("ukjent"),[R,w]=t.useState(null),[$,r]=t.useState(""),[,S]=t.useState(!1),[C,E]=t.useState(null),[c,h]=t.useState("ukjent"),[T,M]=t.useState(null),[F,o]=t.useState(""),[d,L]=t.useState([]),[D,I]=t.useState(!1),[k,j]=t.useState(!1),[m,g]=t.useState(null),x=t.useCallback(()=>{j(!0),g(H)},[]),u=t.useCallback(()=>{j(!1),g(null)},[]),b=t.useMemo(()=>`${B}/hello`,[]),N=t.useMemo(()=>`${B}/dbinfo`,[]),y=t.useCallback(async()=>{S(!0),r(""),x();const s=performance.now();let a="ukjent",p=null;try{const l=await fetch(b);p=l.status,w(l.status),l.ok?(a="ok",f("ok"),r("Backend svarer som forventet.")):(a="feil",f("feil"),r("Backend svarte, men med feil.")),u()}catch{a="feil",f("feil"),r("Ingen respons fra backend."),w(null)}finally{const _=performance.now()-s;E(new Date),S(!1),L(K=>[{time:new Date,status:a,httpCode:p,durationMs:_},...K].slice(0,10))}},[b,x,u]);t.useEffect(()=>{y()},[y]),t.useEffect(()=>{if(!k)return;if(m===0){j(!1);return}const s=window.setInterval(()=>{g(a=>a!==null&&a>0?a-1:a)},1e3);return()=>window.clearInterval(s)},[k,m]);const P=t.useCallback(async()=>{o(""),x();try{const s=await fetch(N);if(M(s.status),s.ok){const a=await s.text();h("ok"),o(a)}else h("feil"),o("DB-endepunkt svarte, men med feil.");u()}catch{h("feil"),M(null),o("Ingen respons fra DB-endepunkt.")}},[N,x,u]),A=async()=>{I(!0);try{await y(),await P()}finally{I(!1)}},W=n==="ok"?"bg-green-100 text-green-800 border-green-300":n==="feil"?"bg-red-100 text-red-800 border-red-300":"bg-slate-100 text-slate-700 border-slate-300",U=c==="ok"?"text-green-700":c==="feil"?"text-red-700":"text-slate-700",O=d.length>0?Math.max(...d.map(s=>s.durationMs||0),1):1;return e.jsxs(z,{title:"Systemstatus",subtitle:"Health-check og responstider for backend.",maxWidthClassName:"max-w-6xl",children:[k&&e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40",children:e.jsxs(i.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-xl max-w-sm w-full px-6 py-5 text-sm text-slate-800",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:"Venter på svar fra tjenesten..."}),e.jsx("p",{className:"mt-2 text-slate-700",children:"Backend kjører på Render (gratisversjon), og kan bruke litt tid på å starte opp når den har vært inaktiv."}),e.jsxs("p",{className:"mt-3 text-xs text-slate-500",children:["Estimert ventetid:"," ",m!==null?`${m} sekunder`:`${H} sekunder`]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Popupen forsvinner automatisk så snart vi får svar fra tjenesten."})]})}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-6",children:[e.jsx(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-2",children:e.jsxs(v,{title:"Backend-status",children:[e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Hello-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:b})]}),e.jsxs(i.div,{variants:V,initial:"initial",animate:"animate",className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm mt-4 ${W}`,"aria-live":"polite",children:[e.jsx("span",{"aria-hidden":"true",className:`h-2.5 w-2.5 rounded-full ${n==="ok"?"bg-green-500":n==="feil"?"bg-red-500":"bg-slate-500"}`}),e.jsx("span",{className:"font-semibold",children:n==="ok"?"Online":n==="feil"?"Offline":"Ukjent"})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-3 mt-4",children:e.jsx("button",{onClick:A,disabled:D,className:"border border-slate-300 text-slate-800 px-4 py-2 rounded-xl text-sm font-semibold hover:bg-slate-50 transition inline-flex items-center justify-center disabled:opacity-60 disabled:cursor-not-allowed",children:D?"Kjører full helsesjekk...":"Full helsesjekk"})}),e.jsxs("p",{className:"mt-3 text-sm text-slate-600",children:["Sist sjekket: ",C?C.toLocaleTimeString():"Aldri"]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["HTTP-kode (hello): ",R??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Melding:"})," ",$]})]})}),e.jsx(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(v,{title:"Detaljert helsesjekk",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:N})]}),e.jsxs("p",{className:`mt-2 ${U}`,children:["Status: ",c==="ok"?"OK":c==="feil"?"Feil":"Ukjent"]}),e.jsxs("p",{className:"text-sm text-slate-700",children:["HTTP-kode (dbinfo): ",T??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-xs text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-melding:"})," ",F||"Ingen sjekk ennå."]})]})})}),e.jsx(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-3",children:e.jsx(v,{title:"Responstid & logg",children:d.length===0?e.jsx("p",{className:"text-sm text-slate-700",children:"Ingen historikk ennå."}):e.jsx("div",{className:"space-y-2 text-xs text-slate-700",children:d.map((s,a)=>{const p=s.durationMs?Math.min(100,s.durationMs/O*100):5,l=s.status==="ok"?"bg-green-500":s.status==="feil"?"bg-red-500":"bg-slate-400";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20",children:s.time.toLocaleTimeString()}),e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${l}`,style:{width:`${p}%`}})}),e.jsx("div",{className:"w-16 text-right",children:s.durationMs?`${Math.round(s.durationMs)} ms`:"-"})]},a)})})})})]})]})}export{Y as default};
