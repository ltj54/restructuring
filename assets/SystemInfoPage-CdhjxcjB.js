import{r as a,b as C,j as e}from"./index-BVVrAzlo.js";import{C as g}from"./Card-c8NqY-G7.js";import{P}from"./PageLayout-DNITwTV4.js";import{m as B}from"./proxy-tG1ptBOy.js";function U(){return e.jsx(B.div,{className:"mr-2 inline-block h-4 w-4 rounded-full border-2 border-blue-500 border-t-transparent",animate:{rotate:360},transition:{repeat:1/0,duration:.8,ease:"linear"}})}function i({width:s="100%",height:r="1rem"}){return e.jsx("div",{className:"animate-pulse rounded bg-slate-200/70",style:{width:s,height:r}})}function E(){return e.jsxs("div",{className:"space-y-3 rounded-xl bg-white p-4 shadow-sm border border-slate-100",children:[e.jsx(i,{width:"60%"}),e.jsx(i,{width:"40%"}),e.jsx(i,{width:"80%",height:"0.8rem"}),e.jsx(i,{width:"70%",height:"0.8rem"})]})}function N({status:s}){const r=s==="ok"?"bg-emerald-100 text-emerald-700 border-emerald-300":s==="feil"?"bg-rose-100 text-rose-700 border-rose-300":"bg-slate-100 text-slate-700 border-slate-300",t=s==="ok"?"bg-emerald-500":s==="feil"?"bg-rose-500":"bg-slate-500";return e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm ${r}`,children:[e.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${t}`}),s==="ok"?"Online":s==="feil"?"Offline":"Ukjent"]})}function R({history:s}){if(s.length===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{width:"40%"}),e.jsx(i,{width:"80%",height:"0.6rem"}),e.jsx(i,{width:"75%",height:"0.6rem"})]});const r=Math.max(...s.map(t=>t.durationMs||1));return e.jsx("div",{className:"space-y-3 text-sm",children:s.map((t,c)=>{const h=t.durationMs?Math.min(100,t.durationMs/r*100):5,d=t.status==="ok"?"bg-emerald-500":t.status==="feil"?"bg-rose-500":"bg-slate-400";return e.jsxs("div",{className:"border border-slate-200 rounded-xl bg-white p-3 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500",children:[e.jsx("span",{children:t.time.toLocaleTimeString()}),e.jsx("span",{className:"font-semibold text-slate-700",children:t.durationMs?`${Math.round(t.durationMs)} ms`:"Ingen måling"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 overflow-hidden rounded-full bg-slate-200",children:e.jsx("div",{className:`h-2 ${d}`,style:{width:`${h}%`}})}),e.jsx(N,{status:t.status})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["HTTP: ",t.httpCode??"-"]})]},c)})})}function W(){const[s,r]=a.useState("ukjent"),[t,c]=a.useState(null),[h,d]=a.useState(""),[,k]=a.useState(!1),[w,D]=a.useState(null),[o,u]=a.useState("ukjent"),[I,v]=a.useState(null),[H,x]=a.useState(""),[b,L]=a.useState([]),S=b[0],p=a.useMemo(()=>`${C}/health`,[]),j=a.useMemo(()=>`${C}/dbinfo`,[]),y=a.useCallback(async()=>{k(!0),d("");const l=performance.now();let n="ukjent",f=null;try{const m=await fetch(p);f=m.status,c(f),m.ok?(n="ok",r("ok"),d("Backend svarer som forventet.")):(n="feil",r("feil"),d("Backend svarte, men med feil."))}catch{n="feil",r("feil"),c(null),d("Ingen respons fra backend.")}finally{const m=performance.now()-l;D(new Date),k(!1),L($=>[{time:new Date,status:n,httpCode:f,durationMs:m},...$].slice(0,10))}},[p]),M=a.useCallback(async()=>{x("");try{const l=await fetch(j);if(v(l.status),l.ok){const n=await l.text();u("ok"),x(n)}else u("feil"),x("DB-endepunkt svarte, men med feil.")}catch{u("feil"),v(null),x("Ingen respons fra DB-endepunkt.")}},[j]);a.useEffect(()=>{let l=null;async function n(){await y(),s==="ok"&&await M(),s==="ok"&&o==="ok"&&l&&clearInterval(l)}return n(),l=window.setInterval(n,3e3),()=>l&&clearInterval(l)},[s,o,y,M]);const T=s!=="ok";return e.jsxs(P,{title:"Systemstatus",subtitle:"Enkel og ryddig oversikt over backend, database og nylige målinger.",maxWidthClassName:"max-w-5xl",children:[T&&e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:[.4,1,.4]},transition:{duration:1.8,repeat:1/0},className:"mb-5 flex items-center rounded-lg border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-900",children:[e.jsx(U,{})," Backend starter opp – sjekker status ..."]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(g,{title:"Backend-status",className:"h-full",children:e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{status:s}),e.jsxs("div",{className:"text-right text-xs text-slate-500",children:[e.jsx("p",{children:"Sist sjekket"}),e.jsx("p",{className:"font-semibold text-slate-700",children:w?w.toLocaleTimeString():"—"})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[e.jsx("p",{className:"font-semibold text-slate-700 mb-1",children:"Health URL"}),e.jsx("p",{className:"break-all text-slate-600",children:p})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3 text-sm",children:[e.jsx("p",{className:"text-slate-500 text-xs",children:"HTTP (health)"}),e.jsx("p",{className:"font-semibold text-slate-800",children:t??"-"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3 text-sm",children:[e.jsx("p",{className:"text-slate-500 text-xs",children:"Responstid"}),e.jsx("p",{className:"font-semibold text-slate-800",children:S?`${Math.round(S.durationMs??0)} ms`:"-"})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3 text-sm",children:[e.jsx("p",{className:"font-semibold text-slate-700",children:"Melding"}),e.jsx("p",{className:"text-slate-600 mt-1",children:h})]})]})}),e.jsx(g,{title:"Database-status",className:"h-full",children:e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsx(N,{status:o}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[e.jsx("p",{className:"font-semibold text-slate-700 mb-1",children:"DB URL"}),e.jsx("p",{className:"break-all text-slate-600",children:j})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border bg-white border-slate-200 p-3 text-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"HTTP (dbinfo)"}),e.jsx("p",{className:"font-semibold text-slate-800",children:I??"-"})]}),e.jsxs("div",{className:"rounded-lg border bg-white border-slate-200 p-3 text-sm",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Status"}),e.jsx("p",{className:"font-semibold text-slate-800",children:o==="ok"?"OK":o==="feil"?"Feil":"Ukjent"})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-3 text-sm",children:[e.jsx("p",{className:"font-semibold text-slate-700",children:"Melding"}),e.jsx("p",{className:"text-slate-600 mt-1 whitespace-pre-wrap",children:H})]})]})})]}),e.jsx(g,{title:"Responshistorikk",className:"mt-6",children:b.length===0?e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{width:"60%"}),e.jsx(i,{width:"50%"}),e.jsx(E,{})]}):e.jsx(R,{history:b})})]})}export{W as default};
