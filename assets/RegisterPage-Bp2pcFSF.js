import{r as n,b as g,g as f,a as h,c as x,j as a,L as b}from"./index-IST0QHVW.js";import{u as w,t as k,F as S,T as p}from"./types-CUtUjmsB.js";import{C as y}from"./Card-BoiwNR6c.js";import{B as j}from"./Button-BIXv3_rL.js";import{P as v}from"./PageLayout-BE_FrvBE.js";import{r as P}from"./authSchemas-Cwv3-339.js";function R(){const[i,e]=n.useState(null),[l,c]=n.useState(null),[m,o]=n.useState(!1),s=w({resolver:k(P),defaultValues:{email:"",password:"",repeatPassword:""},mode:"onTouched"});n.useEffect(()=>{let r=!0;return(async()=>{try{const t=await fetch(`${g}/hello`);if(!r)return;t.ok&&c(await t.text())}catch{r&&c(null)}})(),()=>{r=!1}},[]);const d=n.useMemo(()=>s.handleSubmit(async r=>{e(null),o(!0);try{const t=await fetch(`${g}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r.email,password:r.password})}),u=await t.json().catch(()=>({}));if(!t.ok){e({variant:"error",message:typeof u.message=="string"?u.message:"Noe gikk galt ved registrering."});return}e({variant:"success",message:"Bruker registrert! Du kan nå logge inn."}),s.reset({email:"",password:"",repeatPassword:""})}catch(t){e({variant:"error",message:f(t,"Kunne ikke koble til serveren.")})}finally{o(!1)}}),[s]);return{form:s,feedback:i,apiMessage:l,isSubmitting:m,onSubmit:d}}function A(){const{form:i,feedback:e,isSubmitting:l,onSubmit:c}=R(),{register:m,formState:{errors:o}}=i,s=h(),d=x(),t=new URLSearchParams(s.search).get("redirect")||"/insurance";return a.jsx(v,{title:"Registrer konto",subtitle:"Opprett en konto for å lagre plan og fremdrift.",maxWidthClassName:"max-w-xl",children:a.jsxs(y,{children:[e&&a.jsx(S,{variant:e.variant,message:e.message,action:e.action}),a.jsxs("form",{onSubmit:i.handleSubmit(async u=>{await c(u)&&d(t,{replace:!0})}),className:"flex flex-col gap-5 mt-4",children:[a.jsx(p,{type:"email",label:"E-post",placeholder:"E-post",error:o.email?.message,autoComplete:"email",...m("email")}),a.jsx(p,{type:"password",label:"Passord",placeholder:"Passord",autoComplete:"new-password",error:o.password?.message,...m("password")}),a.jsx(j,{type:"submit",disabled:l,children:l?"Registrerer…":"Registrer"}),a.jsx("div",{className:"text-center mt-1",children:a.jsx(b,{to:`/login?redirect=${encodeURIComponent(s.pathname+s.search+s.hash)}`,className:"text-sm text-slate-600 hover:text-brand-dark hover:underline",children:"Har du konto? Logg inn"})})]})]})})}export{A as default};
