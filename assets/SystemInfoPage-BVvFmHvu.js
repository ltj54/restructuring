import{r as l,b as I,j as e}from"./index-Cl8HYPwz.js";import{C as N}from"./Card-AXOU_HBP.js";import{P as O}from"./PageLayout-CScHowCf.js";import{m as u}from"./proxy-IGDRqAYp.js";function R(){return e.jsx(u.div,{className:"mr-2 inline-block h-4 w-4 rounded-full border-2 border-amber-600 border-t-transparent",animate:{rotate:360},transition:{repeat:1/0,duration:.8,ease:"linear"}})}function t({width:s="100%",height:n="1rem"}){return e.jsx("div",{className:"animate-pulse rounded bg-slate-200/80",style:{width:s,height:n}})}function B(){return e.jsxs("div",{className:"space-y-3 rounded-xl bg-slate-50 p-3",children:[e.jsx(t,{width:"55%"}),e.jsx(t,{width:"35%"}),e.jsx(t,{width:"90%",height:"0.75rem"}),e.jsx(t,{width:"75%",height:"0.75rem"}),e.jsx(t,{width:"50%",height:"0.75rem"})]})}function T({status:s}){const n=s==="ok"?"bg-emerald-100 text-emerald-800 border-emerald-300":s==="feil"?"bg-rose-100 text-rose-800 border-rose-300":"bg-slate-100 text-slate-700 border-slate-300";return e.jsxs("div",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm ${n}`,children:[e.jsx("span",{"aria-hidden":"true",className:`h-2.5 w-2.5 rounded-full ${s==="ok"?"bg-emerald-500":s==="feil"?"bg-rose-500":"bg-slate-500"}`}),e.jsx("span",{className:"font-semibold",children:s==="ok"?"Online":s==="feil"?"Offline":"Ukjent"})]})}function A({history:s}){if(s.length===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{width:"30%"}),e.jsx(t,{width:"90%",height:"0.5rem"}),e.jsx(t,{width:"85%",height:"0.5rem"}),e.jsx(t,{width:"70%",height:"0.5rem"})]});const n=s.length>0?Math.max(...s.map(a=>a.durationMs||0),1):1;return e.jsx("div",{className:"space-y-3 text-sm text-slate-700",children:s.map((a,x)=>{const m=a.durationMs?Math.min(100,a.durationMs/n*100):5,o=a.status==="ok"?"bg-emerald-500":a.status==="feil"?"bg-rose-500":"bg-slate-400";return e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-white/80 p-3 shadow-sm shadow-slate-100",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsx("span",{children:a.time.toLocaleTimeString()}),e.jsx("span",{className:"font-semibold text-slate-700",children:a.durationMs?`${Math.round(a.durationMs)} ms`:"Ingen måling"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 overflow-hidden rounded-full bg-slate-200",children:e.jsx("div",{className:`h-2 ${o}`,style:{width:`${m}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${a.status==="ok"?"bg-emerald-500":a.status==="feil"?"bg-rose-500":"bg-slate-400"}`}),e.jsx("span",{className:"uppercase tracking-wide text-slate-600",children:a.status==="ok"?"OK":a.status==="feil"?"FEIL":"UKJENT"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["HTTP: ",a.httpCode??"-"]})]},x)})})}function q(){const[s,n]=l.useState("ukjent"),[a,x]=l.useState(null),[m,o]=l.useState(""),[,k]=l.useState(!1),[v,D]=l.useState(null),[c,j]=l.useState("ukjent"),[H,y]=l.useState(null),[P,h]=l.useState(""),[g,$]=l.useState([]),r=g[0],p=l.useMemo(()=>`${I}/health`,[]),b=l.useMemo(()=>`${I}/dbinfo`,[]),S=l.useCallback(async()=>{k(!0),o("");const i=performance.now();let d="ukjent",f=null;try{const w=await fetch(p);f=w.status,x(f),w.ok?(d="ok",n("ok"),o("Backend svarer som forventet.")):(d="feil",n("feil"),o("Backend svarte, men med feil."))}catch{d="feil",n("feil"),o("Ingen respons fra backend."),x(null)}finally{const U=performance.now()-i;D(new Date),k(!1),$(E=>[{time:new Date,status:d,httpCode:f,durationMs:U},...E].slice(0,10))}},[p]),C=l.useCallback(async()=>{h("");try{const i=await fetch(b);if(y(i.status),i.ok){const d=await i.text();j("ok"),h(d)}else j("feil"),h("DB-endepunkt svarte, men med feil.")}catch{j("feil"),y(null),h("Ingen respons fra DB-endepunkt.")}},[b]);l.useEffect(()=>{let i=null;async function d(){if(await S(),s==="ok"&&await C(),s==="ok"&&c==="ok"){i&&clearInterval(i);return}}return d(),i=window.setInterval(d,3e3),()=>i&&clearInterval(i)},[s,c,S,C]);const M=s!=="ok",L=c==="ok"?"text-green-700":c==="feil"?"text-red-700":"text-slate-700";return e.jsxs(O,{title:"Systemstatus",subtitle:"Oppdatert oversikt over backend, database og målelogg.",maxWidthClassName:"max-w-6xl",children:[M&&e.jsxs(u.div,{initial:{opacity:0},animate:{opacity:[.45,1,.45]},transition:{duration:1.8,repeat:1/0},className:"mb-4 flex items-center rounded-xl border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900",children:[e.jsx(R,{}),"Backend starter opp, vi oppdaterer statusen fortløpende."]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs(u.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"grid grid-cols-1 gap-6 xl:grid-cols-12",children:[e.jsx("div",{className:"xl:col-span-8",children:e.jsxs(N,{title:"Backend-overvåkning",children:[e.jsxs("div",{className:"rounded-2xl bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 px-5 py-4 text-white shadow-inner shadow-slate-900/10",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-400",children:"Backend"}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:[e.jsx(T,{status:s}),r!=null&&r.durationMs?e.jsxs("div",{className:"rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs text-white/80",children:["Siste responstid: ",Math.round(r.durationMs)," ms"]}):null]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs sm:text-sm",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-slate-300",children:"Sist sjekket"}),e.jsx("p",{className:"font-semibold text-white",children:v?v.toLocaleTimeString():"Aldri"})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-slate-300",children:"HTTP-kode"}),e.jsx("p",{className:"font-semibold text-white",children:a??"-"})]})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"rounded-full bg-white/10 px-3 py-1 text-xs text-white/70",children:p}),e.jsx("span",{className:"text-sm text-white/80",children:m||"Avventer første måling."})]})]}),M?e.jsxs("div",{className:"mt-5 space-y-4",children:[e.jsx(t,{width:"35%",height:"1.4rem"}),e.jsx(B,{})]}):e.jsxs("div",{className:"mt-5 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-slate-500",children:"Health-endepunkt"}),e.jsx("p",{className:"mt-2 break-all text-xs text-slate-600",children:p}),e.jsxs("p",{className:"mt-3 text-sm text-slate-700",children:["HTTP-kode (health): ",e.jsx("span",{className:"font-semibold text-slate-900",children:a??"-"})]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-white p-3 text-sm text-slate-700 shadow-sm shadow-slate-100",children:[e.jsx("span",{className:"font-semibold",children:"Melding:"})," ",m]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm shadow-slate-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-slate-500",children:"Responstid snapshot"}),r?e.jsxs("div",{className:"mt-3 space-y-2 text-sm text-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2",children:[e.jsx("span",{children:"Responstid"}),e.jsxs("span",{className:"font-semibold text-slate-900",children:[Math.round(r.durationMs??0)," ms"]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2",children:[e.jsx("span",{children:"Status"}),e.jsx(T,{status:r.status})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2",children:[e.jsx("span",{children:"HTTP"}),e.jsx("span",{className:"font-semibold text-slate-900",children:r.httpCode??"-"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(t,{width:"70%"}),e.jsx(t,{width:"40%"}),e.jsx(t,{width:"85%"})]})]})]})]})}),e.jsx("div",{className:"xl:col-span-4",children:e.jsx(N,{title:"Database-status",children:c==="ok"?e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-slate-500",children:"DB-endepunkt"}),e.jsx("p",{className:"mt-2 break-all text-xs text-slate-600",children:b}),e.jsxs("p",{className:`mt-3 font-semibold ${L}`,children:["Status: ",c==="ok"?"OK":c==="feil"?"Feil":"Ukjent"]}),e.jsxs("p",{className:"text-sm text-slate-700",children:["HTTP-kode (dbinfo): ",H??"-"]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 text-xs text-slate-700 shadow-sm shadow-slate-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-slate-500",children:"DB-melding"}),e.jsx("p",{className:"mt-2 leading-relaxed",children:P||"Ingen sjekk ennå."})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(t,{width:"45%"}),e.jsx(t,{width:"25%"}),e.jsx(B,{})]})})})]}),e.jsx(u.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(N,{title:"Responstid og logg",children:g.length===0?e.jsxs("div",{className:"space-y-3",children:[e.jsx(t,{width:"70%",height:"0.75rem"}),e.jsx(t,{width:"60%",height:"0.75rem"}),e.jsx(t,{width:"50%",height:"0.75rem"})]}):e.jsx(A,{history:g})})})]})]})}export{q as default};
