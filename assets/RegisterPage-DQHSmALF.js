import{r as i,b as p,g as x,a as b,c as w,j as a,L as k}from"./index-BTLUZozR.js";import{u as S,t as y,F as j,T as f}from"./types-BbFhvWaV.js";import{C as v}from"./Card-C-km7Xwu.js";import{B as P}from"./Button-B87XS7Pq.js";import{P as R}from"./PageLayout-SBILuhi2.js";import{r as C}from"./authSchemas-CpXtHRgh.js";function E(){const[l,e]=i.useState(null),[c,m]=i.useState(null),[u,o]=i.useState(!1),s=S({resolver:y(C),defaultValues:{email:"",password:"",repeatPassword:""},mode:"onTouched"});i.useEffect(()=>{let r=!0;return(async()=>{try{const t=await fetch(`${p}/hello`);if(!r)return;t.ok&&m(await t.text())}catch{r&&m(null)}})(),()=>{r=!1}},[]);const d=i.useMemo(()=>s.handleSubmit(async r=>{e(null),o(!0);try{const t=await fetch(`${p}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r.email,password:r.password})}),n=await t.json().catch(()=>({}));if(!t.ok){e({variant:"error",message:typeof n.message=="string"?n.message:"Noe gikk galt ved registrering."});return}e({variant:"success",message:"Bruker registrert! Du kan nå logge inn."}),s.reset({email:"",password:"",repeatPassword:""})}catch(t){e({variant:"error",message:x(t,"Kunne ikke koble til serveren.")})}finally{o(!1)}}),[s]);return{form:s,feedback:l,apiMessage:c,isSubmitting:u,onSubmit:d}}function I(){var n,g;const{form:l,feedback:e,isSubmitting:c,onSubmit:m}=E(),{register:u,formState:{errors:o}}=l,s=b(),d=w(),t=new URLSearchParams(s.search).get("redirect")||"/insurance";return a.jsx(R,{title:"Registrer konto",subtitle:"Opprett en konto for å lagre plan og fremdrift.",maxWidthClassName:"max-w-xl",children:a.jsxs(v,{children:[e&&a.jsx(j,{variant:e.variant,message:e.message,action:e.action}),a.jsxs("form",{onSubmit:l.handleSubmit(async h=>{await m(h)&&d(t,{replace:!0})}),className:"flex flex-col gap-5 mt-4",children:[a.jsx(f,{type:"email",label:"E-post",placeholder:"E-post",error:(n=o.email)==null?void 0:n.message,autoComplete:"email",...u("email")}),a.jsx(f,{type:"password",label:"Passord",placeholder:"Passord",autoComplete:"new-password",error:(g=o.password)==null?void 0:g.message,...u("password")}),a.jsx(P,{type:"submit",disabled:c,children:c?"Registrerer…":"Registrer"}),a.jsx("div",{className:"text-center mt-1",children:a.jsx(k,{to:`/login?redirect=${encodeURIComponent(s.pathname+s.search+s.hash)}`,className:"text-sm text-slate-600 hover:text-brand-dark hover:underline",children:"Har du konto? Logg inn"})})]})]})})}export{I as default};
