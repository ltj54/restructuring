import{r as a,b as C,j as e}from"./index-DVII_wd_.js";import{C as g}from"./Card-BgmPGXPt.js";import{P as T}from"./PageLayout-v8A4s_Np.js";import{m as o}from"./proxy-MfYStbxC.js";function U(){return e.jsx(o.div,{className:"inline-block h-4 w-4 border-2 border-yellow-600 border-t-transparent rounded-full mr-2",animate:{rotate:360},transition:{repeat:1/0,duration:.8,ease:"linear"}})}function s({width:t="100%",height:i="1rem"}){return e.jsx("div",{className:"bg-slate-200 rounded animate-pulse",style:{width:t,height:i}})}function M(){return e.jsxs("div",{className:"space-y-3",children:[e.jsx(s,{width:"60%"}),e.jsx(s,{width:"40%"}),e.jsx(s,{width:"80%",height:"0.75rem"}),e.jsx(s,{width:"70%",height:"0.75rem"}),e.jsx(s,{width:"50%",height:"0.75rem"})]})}function E({status:t}){const i=t==="ok"?"bg-green-100 text-green-800 border-green-300":t==="feil"?"bg-red-100 text-red-800 border-red-300":"bg-slate-100 text-slate-700 border-slate-300";return e.jsxs("div",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm mt-4 ${i}`,children:[e.jsx("span",{"aria-hidden":"true",className:`h-2.5 w-2.5 rounded-full ${t==="ok"?"bg-green-500":t==="feil"?"bg-red-500":"bg-slate-500"}`}),e.jsx("span",{className:"font-semibold",children:t==="ok"?"Online":t==="feil"?"Offline":"Ukjent"})]})}function A({history:t}){if(t.length===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{width:"30%"}),e.jsx(s,{width:"90%",height:"0.5rem"}),e.jsx(s,{width:"85%",height:"0.5rem"}),e.jsx(s,{width:"70%",height:"0.5rem"})]});const i=t.length>0?Math.max(...t.map(n=>n.durationMs||0),1):1;return e.jsx("div",{className:"space-y-2 text-xs text-slate-700",children:t.map((n,m)=>{const h=n.durationMs?Math.min(100,n.durationMs/i*100):5,c=n.status==="ok"?"bg-green-500":n.status==="feil"?"bg-red-500":"bg-slate-400";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20",children:n.time.toLocaleTimeString()}),e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${c}`,style:{width:`${h}%`}})}),e.jsx("div",{className:"w-16 text-right",children:n.durationMs?`${Math.round(n.durationMs)} ms`:"-"})]},m)})})}function W(){const[t,i]=a.useState("ukjent"),[n,m]=a.useState(null),[h,c]=a.useState(""),[,k]=a.useState(!1),[b,B]=a.useState(null),[d,u]=a.useState("ukjent"),[D,w]=a.useState(null),[I,x]=a.useState(""),[N,H]=a.useState([]),j=a.useMemo(()=>`${C}/hello`,[]),f=a.useMemo(()=>`${C}/dbinfo`,[]),y=a.useCallback(async()=>{k(!0),c("");const l=performance.now();let r="ukjent";try{const p=await fetch(j);m(p.status),p.ok?(r="ok",i("ok"),c("Backend svarer som forventet.")):(r="feil",i("feil"),c("Backend svarte, men med feil."))}catch{r="feil",i("feil"),c("Ingen respons fra backend."),m(null)}finally{const L=performance.now()-l;B(new Date),k(!1),H(P=>[{time:new Date,status:r,httpCode:n,durationMs:L},...P].slice(0,10))}},[j,n]),v=a.useCallback(async()=>{x("");try{const l=await fetch(f);if(w(l.status),l.ok){const r=await l.text();u("ok"),x(r)}else u("feil"),x("DB-endepunkt svarte, men med feil.")}catch{u("feil"),w(null),x("Ingen respons fra DB-endepunkt.")}},[f]);a.useEffect(()=>{let l=null;async function r(){if(await y(),t==="ok"&&await v(),t==="ok"&&d==="ok"){l&&clearInterval(l);return}}return r(),l=window.setInterval(r,3e3),()=>l&&clearInterval(l)},[t,d,y,v]);const S=t!=="ok",$=d==="ok"?"text-green-700":d==="feil"?"text-red-700":"text-slate-700";return e.jsxs(T,{title:"Systemstatus",subtitle:"Health-check og responstider for backend.",maxWidthClassName:"max-w-6xl",children:[S&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:[.45,1,.45]},transition:{duration:1.8,repeat:1/0},className:"mb-4 p-3 text-sm text-yellow-900 bg-yellow-100 border border-yellow-300 rounded-xl flex items-center",children:[e.jsx(U,{}),"Backend vil starte snart (kanskje)…"]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-6",children:[e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-2",children:e.jsxs(g,{title:"Backend-status",children:[e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Hello-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:j})]}),S?e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(s,{width:"30%",height:"1.5rem"}),e.jsx(M,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{status:t}),e.jsxs("p",{className:"mt-3 text-sm text-slate-600",children:["Sist sjekket: ",b?b.toLocaleTimeString():"Aldri"]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["HTTP-kode (hello): ",n??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-sm text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"Melding:"})," ",h]})]})]})}),e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(g,{title:"Detaljert helsesjekk",children:d==="ok"?e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-endepunkt:"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs break-all text-slate-500",children:f})]}),e.jsxs("p",{className:`mt-2 ${$}`,children:["Status: ",d==="ok"?"OK":d==="feil"?"Feil":"Ukjent"]}),e.jsxs("p",{className:"text-sm text-slate-700",children:["HTTP-kode (dbinfo): ",D??"-"]}),e.jsxs("div",{className:"mt-3 rounded-lg bg-slate-100 p-3 text-xs text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"DB-melding:"})," ",I||"Ingen sjekk ennå."]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(s,{width:"50%"}),e.jsx(s,{width:"30%"}),e.jsx(M,{})]})})}),e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-3",children:e.jsx(g,{title:"Responstid & logg",children:N.length===0?e.jsxs("div",{className:"space-y-3",children:[e.jsx(s,{width:"70%",height:"0.75rem"}),e.jsx(s,{width:"60%",height:"0.75rem"}),e.jsx(s,{width:"50%",height:"0.75rem"})]}):e.jsx(A,{history:N})})})]})]})}export{W as default};
